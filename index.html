<!DOCTYPE html>
<html lang="fr">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â Â 
Â  Â  <link rel="icon" type="image/png" href="https://baleinesousgravillon.com/wp-content/uploads/2022/02/cropped-Baleine_sous_gravillon-1-270x270.png">
Â  Â  <link rel="apple-touch-icon" href="https://baleinesousgravillon.com/wp-content/uploads/2022/02/cropped-Baleine_sous_gravillon-1-270x270.png">

Â  Â  <link rel="manifest" href="manifest.json">
Â  Â  <meta name="mobile-web-app-capable" content="yes">
Â  Â  <meta name="apple-mobile-web-app-capable" content="yes">
Â  Â  <meta name="theme-color" content="#0b0e14">
Â  Â  <title>Baleine sous gravillon â€“ Les podcasts</title>
Â  Â  <meta name="title" content="Baleine sous gravillon â€” Les podcasts du Vivant">
Â  Â  <meta name="description" content="Plongez dans les profondeurs du vivant avec notre lecteur de playlists dÃ©diÃ©.">

Â  Â  <meta property="og:type" content="website">
Â  Â  <meta property="og:url" content="https://bsg-univers.github.io/bsg-player/">
Â  Â  <meta property="og:title" content="Baleine sous gravillon â€” Les podcasts du Vivant">
Â  Â  <meta property="og:description" content="Ã‰coutez nos Ã©pisodes et playlists thÃ©matiques. Une immersion sonore unique.">
Â  Â  <meta property="og:image" content="https://baleinesousgravillon.com/wp-content/uploads/2022/05/Banniere_fb_orditel_FG_8-scaled.jpg">

Â  Â  <meta property="twitter:card" content="summary_large_image">
Â  Â  <meta property="twitter:title" content="Baleine sous gravillon â€” Les podcasts">
Â  Â  <meta property="twitter:description" content="Plongez dans les profondeurs du Vivant.">
Â  Â  <meta property="twitter:image" content="https://baleinesousgravillon.com/wp-content/uploads/2022/05/Banniere_fb_orditel_FG_8-scaled.jpg">

Â  Â  <style>
* {
Â  margin: 0;
Â  padding: 0;
Â  box-sizing: border-box;
}

:root{
Â  --primary:#f3c300;

Â  --black-void:#050608;
Â  --blue-abyss:#031b28;
Â  --green-abyss:#04251e;

Â  --glass-soft:rgba(255,255,255,0.04);
Â  --glass-strong:rgba(255,255,255,0.08);
}

body::before{
Â  content:"";
Â  position:fixed;
Â  top:-1px;Â  /* DÃ©calage anti-aliasing */
Â  left:-1px; /* DÃ©calage anti-aliasing */
Â  right:0;
Â  bottom:0;
Â  pointer-events:none;
Â  z-index:-1;
Â  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.035'/%3E%3C/svg%3E");
}


/* ===================== */
/*Â  Â  Â  FOND GLOBALÂ  Â  Â  */
/* ===================== */

html, body{
Â  min-height:100%;
}

body{
Â  font-family:'Segoe UI',Roboto,Helvetica,Arial,sans-serif;
Â  font-size:1.1rem;
Â  color:#eaeaea;
Â  margin:0;
Â  padding-bottom:160px;

Â  min-height:100vh;

Â  background-color:#0b0e14;
Â  background-image:
Â  Â  radial-gradient(circle at 20% 30%, rgba(70,130,180,0.28) 0%, transparent 60%),
Â  Â  radial-gradient(circle at 80% 70%, rgba(0,120,90,0.18) 0%, transparent 65%),
Â  Â  radial-gradient(circle at 50% 50%, rgba(0,40,60,0.22) 0%, transparent 70%);

Â  background-repeat:no-repeat;
Â  background-size:cover;
Â  background-position:center center;
}

/* ===================== */
/*Â  Â  Â  Â  HEADERÂ  Â  Â  Â  Â */
/* ===================== */
/* RÃ©initialisation globale */

header {
Â  position: relative; /* PrioritÃ© d'affichage */
Â  z-index: 10;Â  Â  Â  Â  /* PrioritÃ© d'affichage */
Â  width: 100%;
Â  text-align: center;
Â  padding: 32px 20px;
Â  background: linear-gradient(to bottom,Â 
Â  Â  rgba(0,0,0,0.85) 0%,Â 
Â  Â  rgba(0,0,0,0.85) 5%,Â 
Â  Â  rgba(0,0,0,0.55) 90%);
Â  box-shadow: 0 5px 90px rgba(0,0,0,0.8);
}

.logo-main{
Â  max-width:200px;
Â  margin-bottom:16px;
Â  filter:
Â  Â  drop-shadow(0 0 14px rgba(243,195,0,0.25))
Â  Â  drop-shadow(0 0 40px rgba(243,195,0,0.08));
}

/* lien image */
.site-image-link{
Â  display:inline-block;
Â  margin-right:7px;
Â  width:58px;
Â  height:58px;
Â  border-radius:5px;
Â  overflow:hidden;
Â  background:#000;
Â  box-shadow:
Â  Â  0 0 0 1px rgba(243,195,0,0.15),
Â  Â  0 15px 35px rgba(0,0,0,0.8);
Â  transition:transform .35s ease, box-shadow .35s ease;
}

.site-image-link:hover{
Â  transform:translateY(-4px) scale(1.06);
Â  box-shadow:
Â  Â  0 0 0 1px rgba(243,195,0,0.35),
Â  Â  0 20px 45px rgba(0,0,0,0.9);
}

.site-image-link img{
Â  width:100%;
Â  height:100%;
Â  object-fit:cover;
}

/* ===================== */
/*Â  Â  Â  Â CONTENUÂ  Â  Â  Â  Â */
/* ===================== */
.container{
Â  max-width:820px;
Â  margin:auto;
Â  padding:28px 20px;
}

h2,h3{
Â  color:var(--primary);
Â  font-size:1rem;
Â  letter-spacing:1px;
Â  text-transform:uppercase;
Â  margin:32px 0 18px;
Â  padding-left:14px;
Â  border-left:3px solid var(--primary);
Â  text-shadow:0 0 10px rgba(243,195,0,0.15);
}

/* ===================== */
/* SAISONS RELOADEDÂ  Â  */
/* ===================== */
.grid-list {
Â  display: grid;
Â  grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
Â  gap: 20px;
Â  perspective: 1000px; /* Pour un effet de profondeur */
}

.season-item {
Â  position: relative;
Â  padding: 20px 15px;
Â  font-weight: 700;
Â  font-size: 0.95rem;
Â  color: rgba(255,255,255,0.9);
Â  text-align: center;
Â  cursor: pointer;
Â  z-index: 1;
Â  overflow: hidden;

Â  Â  /* Supprime le rectangle bleu sur mobile */
Â  -webkit-tap-highlight-color: transparent;
Â Â 
Â  /* Supprime le contour de sÃ©lection au focus (clavier/accessibilitÃ©) */
Â  outline: none;
Â  Â Â 
Â  /* Forme "Galet" irrÃ©guliÃ¨re */
Â  border-radius: 60% 40% 70% 30% / 40% 50% 60% 40%;
Â Â 
Â  /* Look Abyss Glass */
Â  background: rgba(255, 255, 255, 0.03);
Â  border: 1px solid rgba(243, 195, 0, 0.2);
Â  backdrop-filter: blur(8px);
Â  -webkit-backdrop-filter: blur(8px);
Â Â 
Â  /* Ombre douce et lueur interne */
Â  box-shadow:Â 
Â  Â  0 10px 20px rgba(0,0,0,0.3),
Â  Â  inset 0 0 15px rgba(243, 195, 0, 0.05);

Â  /* Animation de flottaison */
Â  animation: float 6s ease-in-out infinite;
Â  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

/* On dÃ©cale l'animation pour chaque bouton pour un effet naturel */
.season-item:nth-child(even) {
Â  animation-duration: 7s;
Â  border-radius: 40% 60% 35% 65% / 50% 40% 60% 50%;
}

@keyframes float {
Â  0%, 100% { transform: translateY(0px) rotate(0deg); }
Â  50% { transform: translateY(-10px) rotate(2deg); }
}

.season-item:hover {
Â  background: var(--primary);
Â  color: #0b0e14;
Â  transform: scale(1.1) rotate(-2deg);
Â  border-color: var(--primary);
Â  box-shadow: 0 15px 30px rgba(243, 195, 0, 0.3);
Â  animation-play-state: paused; /* S'arrÃªte quand on le survole */
}

.season-item:hover::after {
Â  left: 120%;
}

.season-item:active {
Â  transform: scale(0.95);
}

/* ===================== */
/*Â  Â  Â  Ã‰PISODESÂ  Â  Â  Â  Â */
/* ===================== */
.episode-item{
Â  margin-bottom:10px;
Â  padding:16px 20px;
Â  border-radius:16px;

Â  display:flex;
Â  align-items:center;
Â  justify-content:space-between;

Â  cursor:pointer;
Â  border-left:0 solid var(--primary);
Â  transition:all .25s ease;
Â  Â  Â  Â  /* Supprime le rectangle bleu sur mobile */
Â  -webkit-tap-highlight-color: transparent;
Â Â 
Â  /* Supprime le contour de sÃ©lection au focus (clavier/accessibilitÃ©) */
Â  outline: none;
}

.episode-item:hover{
Â  background:
Â  Â  linear-gradient(160deg,
Â  Â  Â  rgba(255,255,255,0.08),
Â  Â  Â  rgba(255,255,255,0.02));
}

.episode-item.current{
Â  border-left:6px solid var(--primary);

Â  box-shadow:
Â  Â  0 5px 15px rgba(0,0,0,0.35);
}

.episode-title{
Â  flex-grow:1;
Â  margin-right:14px;
Â  font-size:1rem;;
}

/* bouton partage */
/* bouton partage */
.btn-share {
Â  flex-shrink: 0; /* Empeche le cercle de s'Ã©craser */
Â  background: transparent;
Â  border: 1px solid rgba(243,195,0,0.6);
Â  color: var(--primary);
Â  width: 34px;
Â  height: 34px;
Â  border-radius: 50%;
Â  display: flex;
Â  align-items: center;
Â  justify-content: center;
Â  cursor: pointer;
Â  transition: all .3s ease;
Â  animation: pulse-border 12s infinite ease-in-out;
Â  Â  Â  /* Supprime le rectangle bleu sur mobile */
Â  -webkit-tap-highlight-color: transparent;
Â Â 
Â  /* Supprime le contour de sÃ©lection au focus (clavier/accessibilitÃ©) */
Â  outline: none;
}

@keyframes pulse-border {
Â  0%, 100% { border-color: rgba(243, 195, 0, 0.3); box-shadow: 0 8px 20px rgba(0,0,0,0.6); }
Â  50% { border-color: rgba(243, 195, 0, 0.8); box-shadow: 0 0 15px rgba(243, 195, 0, 0.4); }
}

.btn-share:hover{
Â  background:var(--primary);
Â  color:#111;
}

/* ===================== */
/* PLAYER UNIFIÃ‰Â  Â  Â  */
/* ===================== */
.player-container {
Â  Â  position: fixed;
Â  Â  bottom: 0;
Â  Â  left: 0;
Â  Â  right: 0;

Â  Â  /* Effet Abyss Glass cohÃ©rent */
Â  Â  background: rgba(11, 14, 20, 0.95);
Â  Â  backdrop-filter: blur(20px);
Â  Â  -webkit-backdrop-filter: blur(20px);

Â  Â  /* Forme "Galet" uniquement sur le haut pour rester collÃ© en bas */
Â  Â  /* On crÃ©e une ondulation organique sur la bordure supÃ©rieure */
Â  Â  border-radius: 70px 70px 0 0 / 25px 25px 0 0;
Â  Â Â 
Â  Â  padding: 20px 30px 25px;
Â  Â Â 
Â  Â  /* Bordure dorÃ©e fine comme les boutons */
Â  Â  border-top: 1px solid rgba(243, 195, 0, 0.3);
Â  Â Â 
Â  Â  /* Lueur interne et ombre profonde */
Â  Â  box-shadow:Â 
Â  Â  Â  Â  0 -15px 40px rgba(0,0,0,0.8),
Â  Â  Â  Â  inset 0 2px 15px rgba(243, 195, 0, 0.1);
Â  Â Â 
Â  Â  z-index: 1000;
Â  Â Â 
Â  Â  /* Animation trÃ¨s subtile pour rappeler la flottaison des boutons */
Â  Â  animation: playerSubtleWave 10s ease-in-out infinite;
}

@keyframes playerSubtleWave {
Â  Â  0%, 100% { border-top-color: rgba(243, 195, 0, 0.3); }
Â  Â  50% { border-top-color: rgba(243, 195, 0, 0.6); }
}

.now-playing {
Â  Â  text-align: center;
Â  Â  font-size: 0.9rem;
Â  Â  font-weight: 700;
Â  Â  color: var(--primary);
Â  Â  margin-bottom: 14px;
Â  Â  text-shadow: 0 0 15px rgba(243, 195, 0, 0.4);
Â  Â  /* Pour Ã©viter que le titre ne casse la forme */
Â  Â  white-space: nowrap;
Â  Â  overflow: hidden;
Â  Â  text-overflow: ellipsis;
}

audio {
Â  Â  width: 100%;
Â  Â  height: 40px;
Â  Â  border-radius: 50px; /* Style pilule pour le lecteur */
Â  Â  /* Filtre pour rendre le lecteur natif plus Ã©lÃ©gant sur fond noir */
Â  Â  filter: invert(100%) hue-rotate(180deg) brightness(1.5) contrast(0.8);
Â  Â  opacity: 0.9;
}

/* ===================== */
/*Â  Â  Â  Â TOASTÂ  Â  Â  Â  Â  Â */
/* ===================== */
#toast{
Â  opacity:0;
Â  pointer-events:none;

Â  min-width:200px;
Â  background:var(--primary);
Â  color:#111;
Â  text-align:center;
Â  border-radius:30px;
Â  padding:12px 18px;

Â  position:fixed;
Â  left:50%;
Â  bottom:120px;
Â  transform:translate(-50%, 12px);

Â  font-weight:700;
Â  font-size:.8em;

Â  box-shadow:0 10px 30px rgba(0,0,0,0.8);

Â  transition:
Â  Â  opacity .35s ease,
Â  Â  transform .35s ease;
}

#toast.show{
Â  opacity:1;
Â  transform:translate(-50%, 0);
}


.loader{
Â  text-align:center;
Â  color:var(--primary);
Â  padding:24px;
Â  font-style:italic;
}
</style>
</head>
<body>

<header>
<a href="https://baleinesousgravillon.com/" target="_blank" title="Aller sur le site officiel">
Â  Â  <img src="https://baleinesousgravillon.com/wp-content/uploads/2023/08/logo-accueil3Plan-de-travail-2-copie-3@2x-1.png" alt="Logo" class="logo-main"><br>
</a>
<a href="https://baleinesousgravillon.com/" target="_blank" class="site-image-link" title="Aller sur le site officiel">
Â  Â  <img src="https://image.ausha.co/CQMRa8hZ950ZAamQlgLxjsA38VuxGAXyvYCZXFXK_400x400.jpeg" alt="Lien Site">
</a>
<a href="https://baleinesousgravillon.com/" target="_blank" class="site-image-link" title="Aller sur le site officiel">
Â  Â  <img src="https://image.ausha.co/A7P2IR07j1IuiB6cAAY9LjKIEcrbr4dPsgqobQHP_400x400.jpeg" alt="Lien Site">
</a>
<a href="https://baleinesousgravillon.com/" target="_blank" class="site-image-link" title="Aller sur le site officiel">
Â  Â  <img src="https://image.ausha.co/CBnPjfz7mxzBMJg4Fc3OGIHETweeY5jv4GH5JdU0_400x400.jpeg" alt="Lien Site">
</a>
<a href="https://baleinesousgravillon.com/" target="_blank" class="site-image-link" title="Aller sur le site officiel">
Â  Â  <img src="https://image.ausha.co/0xC11gNAqCw0Flp5qCUhuWM9kJI3p8Lw6J3lLm5w_400x400.jpeg" alt="Lien Site">
</a>
</header>

<div class="container">
Â  Â  <div id="seasons_grid" class="grid-list"></div>
Â  Â  <div id="episodes_list"></div>
</div>

<div class="player-container">
Â  Â  <div id="now-playing-title" class="now-playing">SÃ©lectionnez une aventure...</div>
Â  Â  <audio id="player" style="border-radius: 15px;" controls playsinline preload="auto"></audio>
</div>

<script>
// --- CONFIGURATION ---
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwm-8iBh2aMDepvxSHpl0ywwlZpWIaEEh7veSNYyEG-X0gSalh6--vbhxyV4PR2GXMjvQ/exec";
let episodes = [];
let current = 0;
let allPlaylists = [];
const audio = document.getElementById('player');
const titleDisplay = document.getElementById('now-playing-title');

// --- LOGIQUE API ---
async function callApi(params) {
Â  Â  const url = `${SCRIPT_URL}?${params}`;
Â  Â  const response = await fetch(url);
Â  Â  return await response.json();
}

async function loadPlaylists() {
Â  Â  const urlParams = new URLSearchParams(window.location.search);
Â  Â  const initialPlaylistId = urlParams.get('playlistId') ? decodeURIComponent(urlParams.get('playlistId').replace(/\+/g, ' ')) : null;
Â  Â Â 
Â  Â  allPlaylists = await callApi("action=getPlaylists");
Â  Â  allPlaylists = allPlaylists.filter(p => p.public);
Â  Â Â 
Â  Â  const seasons = [...new Set(allPlaylists.map(p => p.season))].sort().reverse();
Â  Â  const div = document.getElementById('seasons_grid');
Â  Â  div.innerHTML = seasons.map(s => `<div class="season-item" onclick="showPlaylistsBySeason('${s}')">${s}</div>`).join('');

Â  Â  if (initialPlaylistId) {
Â  Â  Â  Â  const sharedPlaylist = allPlaylists.find(p => String(p.id).trim() === initialPlaylistId.trim());
Â  Â  Â  Â  if (sharedPlaylist) {
Â  Â  Â  Â  Â  Â  showPlaylistsBySeason(sharedPlaylist.season);
Â  Â  Â  Â  Â  Â  loadEpisodes(sharedPlaylist.id);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  showPlaylistsBySeason(seasons[0]);
Â  Â  Â  Â  }
Â  Â  } else {
Â  Â  Â  Â  showPlaylistsBySeason(seasons[0]);
Â  Â  }
}

function showPlaylistsBySeason(season) {
Â  Â  document.querySelectorAll('.season-item').forEach(btn => {
Â  Â  Â  Â  btn.style.borderColor = btn.innerText === season ? "var(--primary)" : "rgba(243, 195, 0, 0.2)";
Â  Â  Â  Â  btn.style.background = btn.innerText === season ? "rgba(243, 195, 0, 0.15)" : "rgba(255, 255, 255, 0.03)";
Â  Â  });
Â  Â Â 
Â  Â  const filtered = allPlaylists.filter(p => p.season === season);
Â  Â  const div = document.getElementById('episodes_list');
Â  Â  div.innerHTML = `<h2>Playlists â€” ${season}</h2>` + filtered.map(p => {
Â  Â  Â  Â  const encodedId = btoa(unescape(encodeURIComponent(p.id)));
Â  Â  Â  Â  return `
Â  Â  Â  Â  <div class="episode-item" onclick="loadEpisodes('${encodedId}', true)">
Â  Â  Â  Â  Â  Â  <span class="episode-title"><strong>${p.name}</strong></span>
Â  Â  Â  Â  Â  Â  <button class="btn-share" onclick="sharePlaylist(event, '${encodedId}')">ðŸ”—</button>
Â  Â  Â  Â  </div>`;
Â  Â  }).join('');
}

function sharePlaylist(event, encodedPid) {
Â  Â  event.stopPropagation();
Â  Â  const pid = decodeURIComponent(escape(atob(encodedPid)));
Â  Â  const url = new URL(window.location.origin + window.location.pathname);
Â  Â  url.searchParams.set('playlistId', pid);
Â  Â  navigator.clipboard.writeText(url.toString()).then(showToast);
}
Â  Â Â 
function showToast() {
Â  Â  const toast = document.getElementById("toast");
Â  Â  toast.className = "show";
Â  Â  setTimeout(() => { toast.className = ""; }, 3000);
}
Â  Â Â 
async function loadEpisodes(pid, isEncoded = false) {
Â  Â  const cleanId = isEncoded ? decodeURIComponent(escape(atob(pid))) : pid;
Â  Â  const listDiv = document.getElementById('episodes_list');
Â  Â  listDiv.innerHTML = '<div class="loader">PlongÃ©e...</div>';
Â  Â  episodes = await callApi(`action=getEpisodes&playlistId=${encodeURIComponent(cleanId)}`);
Â  Â Â 
Â  Â  if (!episodes || episodes.length === 0) {
Â  Â  Â  Â  listDiv.innerHTML = '<p>Aucun Ã©pisode trouvÃ©.</p>';
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  listDiv.innerHTML = `<h3>Ã‰pisodes</h3>` + episodes.map((e, i) => `
Â  Â  Â  Â  <div class="episode-item list-item-ep" id="ep-${i}" onclick="play(${i})">
Â  Â  Â  Â  Â  Â  <span class="episode-title">${e.title}</span>
Â  Â  Â  Â  Â  Â  <span style="color:var(--primary); font-size: 0.8em;">â–¶</span>
Â  Â  Â  Â  </div>`).join('');
Â  Â  play(0);
}

async function play(i) {
    current = i;

    // 1. Mise Ã  jour visuelle immÃ©diate de la liste
    document.querySelectorAll('.list-item-ep').forEach(el => el.classList.remove('current'));
    const activeItem = document.getElementById(`ep-${i}`);
    if (activeItem) activeItem.classList.add('current');
    
    // 2. Information immÃ©diate pour l'utilisateur
    titleDisplay.innerText = "PlongÃ©e en cours...";

    // 3. Forcer l'Ã©tat MediaSession au dÃ©but pour Ã©viter que le mobile ne coupe le processus
    if ('mediaSession' in navigator) {
        navigator.mediaSession.playbackState = "playing";
    }

    // 4. Appel Ã  votre API pour rÃ©cupÃ©rer l'URL audio
    try {
        const audioUrl = await callApi(`action=getAudio&guid=${episodes[i].guid}`);
        
        if (audioUrl) {
            audio.src = audioUrl;
            audio.load(); // Indispensable pour les flux dynamiques
            
            audio.oncanplay = () => {
                titleDisplay.innerText = episodes[i].title;
                
                // 5. Lancer la lecture
                audio.play().then(() => {
                    // DÃ©lai de 200ms pour s'assurer que le flux est stable avant d'envoyer les mÃ©tadonnÃ©es
                    setTimeout(() => {
                        updateMediaSession(episodes[i].title);
                        if ('mediaSession' in navigator) {
                            navigator.mediaSession.playbackState = "playing";
                        }
                    }, 200);
                }).catch(e => {
                    console.log("Erreur lecture (souvent liÃ©e au blocage navigateur):", e);
                    titleDisplay.innerText = "Cliquez sur Play â–¶ pour commencer la lecture.";
                });
            };
        }
    } catch (error) {
        console.error("Erreur lors de la rÃ©cupÃ©ration de l'Ã©pisode:", error);
        titleDisplay.innerText = "Erreur de connexion...";
    }
}

function updateMediaSession(title) {
Â  Â  if ('mediaSession' in navigator) {
Â  Â  Â  Â  navigator.mediaSession.metadata = new MediaMetadata({
Â  Â  Â  Â  Â  Â  title: title,
Â  Â  Â  Â  Â  Â  artist: "Baleine sous gravillon",
Â  Â  Â  Â  Â  Â  album: "Le podcast du Vivant",
Â  Â  Â  Â  Â  Â  artwork: [
Â  Â  Â  Â  Â  Â  Â  Â  { src: 'https://baleinesousgravillon.com/wp-content/uploads/2022/02/cropped-Baleine_sous_gravillon-1-270x270.png', sizes: '270x270', type: 'image/png' },
Â  Â  Â  Â  Â  Â  Â  Â  { src: 'https://image.ausha.co/CQMRa8hZ950ZAamQlgLxjsA38VuxGAXyvYCZXFXK_400x400.jpeg', sizes: '400x400', type: 'image/jpeg' }
Â  Â  Â  Â  Â  Â  ]
Â  Â  Â  Â  });

Â  Â  Â  Â  // Forcer les handlers Ã  chaque mise Ã  jour
Â  Â  Â  Â  const actions = [
Â  Â  Â  Â  Â  Â  ['play', () => audio.play()],
Â  Â  Â  Â  Â  Â  ['pause', () => audio.pause()],
Â  Â  Â  Â  Â  Â  ['previoustrack', current > 0 ? () => play(current - 1) : null],
Â  Â  Â  Â  Â  Â  ['nexttrack', current + 1 < episodes.length ? () => play(current + 1) : null],
Â  Â  Â  Â  Â  Â  ['seekbackward', (details) => { audio.currentTime -= (details.seekOffset || 10); }],
Â  Â  Â  Â  Â  Â  ['seekforward', (details) => { audio.currentTime += (details.seekOffset || 10); }]
Â  Â  Â  Â  ];

Â  Â  Â  Â  for (const [action, handler] of actions) {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  navigator.mediaSession.setActionHandler(action, handler);
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.log(`L'action "${action}" n'est pas supportÃ©e.`);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }
}

// --- GESTIONNAIRES D'Ã‰VÃ‰NEMENTS ---

// 1. DÃ©bloque l'audio pour le mode PWA/Mobile dÃ¨s le premier clic
document.addEventListener('click', () => {
    if (audio.paused && !audio.src) {
        // Un micro-play/pause suffit Ã  dire au navigateur : "L'utilisateur autorise le son"
        audio.play().then(() => audio.pause()).catch(() => {});
    }
}, { once: true });

// 2. Met Ã  jour l'affichage sur l'Ã©cran de verrouillage
audio.addEventListener('play', () => {
    if ('mediaSession' in navigator) navigator.mediaSession.playbackState = "playing";
});

audio.addEventListener('pause', () => {
    if ('mediaSession' in navigator) navigator.mediaSession.playbackState = "paused";
});

// 3. ENCHAÃŽNEMENT AUTOMATIQUE (Le cÅ“ur du problÃ¨me)
audio.addEventListener('ended', () => {
    console.log("Ã‰pisode terminÃ©, tentative de passage au suivant...");
    if (current + 1 < episodes.length) {
        play(current + 1);
    }
});

// --- INITIALISATION ---
loadPlaylists();

if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js').catch(err => console.log("Erreur SW", err));
}
</script>
Â  Â  <div id="toast">Lien copiÃ© !</div>
</body>
</html>
